## 精英怪物 迷尼库普(minikube)

[minikube](https://kubernetes.io/docs/setup/minikube/)

#### install

略

```bash
#some important
sudo curl -L https://github.com/dhiltgen/docker-machine-kvm/releases/download/v0.7.0/docker-machine-driver-kvm -o /usr/local/bin/docker-machine-driver-kvm

  sudo chmod +x /usr/local/bin/docker-machine-driver-kvm
  
  
  sudo virsh net-list --all
  
  sudo virsh net-start default
```



#### use

```bash
#kvm
minikube start --vm-driver=kvm --registry-mirror=http://f1361db2.m.daocloud.io
```

failed in china



## 精英女妖库普阿弥(kubeadm)

[kubeadm](https://kubernetes.io/docs/setup/independent/install-kubeadm/)

#### install

```bash
sudo swapoff -a 

# 国内源
cat <<EOF > /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg
        http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF


# Set SELinux in permissive mode (effectively disabling it)
setenforce 0
sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config

yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes

systemctl enable --now kubelet

```

#### run (init)

```bash
#host
vim /etc/hostname 
k8s-master
hostname -F /etc/hostname

#local dns
vim /etc/hosts
172.16.227.40    k8s-master

#firewalld
systemctl disable firewalld
#selinux
sed -i s/SELINUX=enforcing/SELINUX=disabled/g /etc/selinux/config
 
#start params
cat <<EOF >  /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sysctl --system

#docker kubeadm, kubelet and kubectl
yum install -y yum-utils device-mapper-persistent-data lvm2
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
yum list docker-ce --showduplicates | sort -r
yum install docker-ce-18.06.3.ce-3.el7
systemctl start docker
systemctl enable docker

cat <<EOF > /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF

yum install -y kubelet kubeadm kubectl
systemctl enable kubelet && systemctl start kubelet

kubeadm config images list
kubeadm config images pull 

echo 1 > /proc/sys/net/bridge/bridge-nf-call-iptables
echo 1 > /proc/sys/net/bridge/bridge-nf-call-ip6tables

# 添加--image-repository参数，默认镜像下载会失败，你懂的
kubeadm init --kubernetes-version=v1.14.2 --pod-network-cidr=10.244.0.0/16 --image-repository registry.aliyuncs.com/google_containers

#### kubectl 授权
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config


# 安装网络
kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml

#查看集群装填 
kubectl get pods -n kube-system


```

#### join (kubeadm join)

```bash
kubeadm token create
#获取token
kubeadm token list

#获取ca证书sha256编码hash值
openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'

echo 1 > /proc/sys/net/bridge/bridge-nf-call-iptables
echo 1 > /proc/sys/net/bridge/bridge-nf-call-ip6tables

#join

kubeadm join 192.168.12.235:6443 --token cc2fxo.nwitlz28w9f3wl1f \
    --discovery-token-ca-cert-hash sha256:5a820c68201836bf6b6c69202472f9794faec6e1eb820b5661c07c2add3f81fb


```

#### dashboard

```bash

wget https://raw.githubusercontent.com/kubernetes/dashboard/master/aio/deploy/recommended/kubernetes-dashboard.yaml


# 替换国内源
sed -i 's/k8s.gcr.io/registry.cn-hangzhou.aliyuncs.com\/google_containers/g' kubernetes-dashboard.yaml
kubectl create -f kubernetes-dashboard.yaml


kubectl get po -n kube-system


#kubectl get svc kubernetes-dashboard -n kube-system --output yaml
#kubectl get svc kubernetes-dashboard -n kube-system 
# 发布
#kubectl patch svc kubernetes-dashboard -p '{"spec":{"type":"NodePort"}}' -n kube-system

#kubectl get svc kubernetes-dashboard -n kube-system 

# 代理方式访问
kubectl proxy --address=0.0.0.0 --disable-filter=true
#  访问
http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy

## many todos
```



next [runbasic](./c2.runBasic.md)